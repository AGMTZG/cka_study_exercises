# Advanced Kustomize Multi-Environment Deployment with Overlays, Patches, ConfigMaps, and Secrets

### You are responsible for deploying a microservice application in Kubernetes using Kustomize, starting with its database. The company operates two environments dev, and prod each with distinct requirements for replicas, container images, environment variables, and resources such as ConfigMaps and Secrets..

Tasks:

- **Base**

  - StatefulSet:

    - replicas: 1

    - image: mysql:latest

    - Enviroment variables:
      - MYSQL_ROOT_PASSWORD: 12345678

    - Volume Mounts:
      - path: /var/lib/mysql
        name: mysql_volume

    - persistent volume claim(using the db_storage StorageClass with a dynamic provisioner)
      - Create one persistent volume claim named my-pvc
      - requests: 1Gi
      - accessMode: ReadWriteOnce
      - Note: Apply the PersistentVolumeClaim, but do not manage it with Kustomize.

    - port 3306
        
  - HeadlessService:

    - clusterIP: none

    - Port: 3306

    - TargetPort: 3306

- **Overlay Dev**

  - Change image to mysql:dev

  - Add label env: dev to all resources

  - Add environment variable DEBUG=true

  - Add a patch to include an initContainer with image busybox to change permissions of the folder /var/lib/mysql with user mysql using chown

  - ConfigMap(generated by kustomize):
     - filename: db_host
     - DB_HOST=localhost
     - DB_PASSWORD=3306

  - Secret(generated by kustomize):
     - filename: db_secret
     - USERNAME: admin
     - PASSWORD: asdfqwerty

- **Overlay Prod** 

  - Change image to mysql:prod

  - Add label env: prod to all resources

  - ConfigMap(generated by kustomize):
     - filename: db_host
     - DB_HOST=localhost
     - DB_PASSWORD=3306

  - Secret(generated by kustomize):
     - filename: db_secret
     - USERNAME: admin
     - PASSWORD: asdfqwerty

  - Add tolerations for nodes with taint prod=true:NoSchedule

  - Add resource limits and requests
    - requests:
      - cpu: "500m"       
      - memory: "1Gi"     
    - limits:
      - cpu: "1"        
      - memory: "2Gi"    

